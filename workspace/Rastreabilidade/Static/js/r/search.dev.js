/*
* Bind do autocomplete no cabe√ßalho
* ajustando o tamanho e estilo do campo para compensar a borda curvada do input
*/
//TODO: Usar valores reais obtidos do banco
//var autocompleteMock = ["Acordo","CineSemana","Divulgacao","DivulgacaoMedia","Fatura","FaturaTributacao","HistoricoCurvaABC","MediaSala","Negociacao","NegociacaoSemana","NegociacaoSemanaCopia","ParametrosCurvaABC","TipoNegociacao","TipoNegociacaoExibicao","Area","AreaCanalVenda","AreaMatriz","AtributoExterno","Classe","ClasseTipoSistemaVenda","Complexo","ConfiguracaoPontuacao","Contato","Curvatura","Elemento","ElementoConfiguracao","ElementoPosicao","ElementoTipoBloqueio","Empresa","EmpresaMoeda","EntidadeExterna","EntidadeExternaObjetoBD","EntidadeExternaTipoEntidadeExterna","EstabAcrescimoTipoExibicao","EstabelecimentoAcrescimo","EstabelecimentoAcrescimoValor","Estabelecimento","EstabelecimentoCanalFormaPagto","EstabelecimentoCanalVenda","EstabelecimentoDesconto","EstabelecimentoFormaPagamento","EstabelecimentoTipoEstab","Fornecedor","FornecedorEndereco","FornecedorFuncCalendario","FornecedorTipoSistemaVenda","Grupo","GrupoFinanceiro","GrupoTipoElemento","Layout","LayoutVigencia","Local","LocalAcesso","LocalAcessoArea","LocalTipoExibicao","MesaSetorBombEstabelecimento","ObjetoBD","RotaAcesso","RotaAcessoLocalAcesso","Setor","SetorBombEstabelecimento","TipoClasse","TipoElemento","TipoEntidadeExterna","TipoEstabelecimento","Funcionalidade","FuncionalidadeTipoCalendario","GrupoAcesso","GrupoAcessoEstabelecimento","GrupoAcessoTipoSistemaVenda","PerfilAcesso","Permissao","Sistema","SistemaFuncionalidade","TipoAutenticacao","TipoPermissao","TipoValidacao","Usuario","UsuarioEstabelecimento","UsuarioFornecedor","UsuarioSenhaHistorico","Acrescimo","CalendarioVendaProdutoClasse","Campanha","CanalVenda","CaracProdutoTpMovOperacional","CaracteristicaProduto","Cartaz","CategoriaProduto","ClasseHorario","ClasseHorarioDia","ClassePreco","ClassePrecoCustomizado","ClassePrecoCustomizadoValor","ClassePrecoValor","Classificacao","ClassificacaoProduto","CodigoBarraProduto","Comercial","CompetenciaTributo","Composicao","ComposicaoIngresso","ConcentradorProduto","ConcentradorProdutoDetalhe","ConfiguracaoTributacao","ConfiguracaoVendaProduto","Contrato","Copia","Departamento","Desconto","DestinoComanda","DestinoComandaProduto","Devolucao","DispositivoAcesso","EstabDescontoIngresso","EstabelecimentoComposicao","EstabelecimentoIngresso","Evento","EventoCidade","EventoEstabelecimento","EventoFornecedor","EventoParticipante","EventoProgramado","EventoProgramadoPeriodo","FormaPagamentoProduto","FormaValidacao","FormaValidacaoTipoValidacao","Genero","GrupoProdObservacaoVenda","GrupoProduto","GrupoProdutoCaractProduto","GrupoTributacao","GrupoTributacaoAliquota","GrupoTributacaoNCM","ImpressoraComanda","Ingresso","IngressoEspecial","IngressoEspecialCupom","IngressoEspecialDiaSemana","IngressoEspecialFormaPagamento","IngressoEspecialProduto","IngressoEspecialValidacao","IngressoEspecialVigencia","ItemCaracteristicaProduto","ItemVenda","ListaValores","Marca","MixProduto","MixProdutoClasse","NatOperSituacaoTributaria","NaturezaOperTpMovOperacional","NaturezaOperacional","ObservacaoVenda","OrigemMercadoria","Participante","ParticipanteTipoParticipante","Personalizacao","PrecoPadrao","Produto","ProdutoCaracteristicaProduto","ProdutoEstabelecimento","ProdutoFornecedor","ProdutoFornecedorUnidade","ProdutoItemCaractProduto","ItemReceita","ProdutoMixProduto","ProdutoSituacaoUnidade","Propaganda","PropagandaCopia","PropagandaCopiaEstabelecimento","ReceitaGrupo","ReceitaProduto","RelacionamentoUnidade","RemarcacaoPreco","RemarcacaoPrecoCalendario","RemarcacaoPrecoClasse","Sessao","SetorBomboniere","Situacao","SubTipoEspecial","TelaVenda","TelaVendaItem","TipoCaracteristicaProduto","TipoCopia","TipoEntrega","TipoEspecial","TipoEvento","TipoEventoSite","TipoExibicao","TipoExibicaoComposto","TipoLegenda","TipoLente","TipoParticipante","TipoSom","TipoProgDiaSemana","TipoProgramacao","TipoSom","TipoValidacao","TipoVendaProduto","Trailler","TraillerMidia","TraillerMidiaCanalVenda","Tributacao","TributacaoAliquota","TributacaoTipoMovOperacional","UnidadeMedida","ValoresValidacao","CEP","Cidade","Cotacao","DataEspecial","DataEspecialEstabelecimento","DiaSemana","Endereco","Estado","FusoHorario","HorarioVerao","Idioma","Logradouro","Moeda","MoedaValor","Pais","Tempo","TipoDataEspecial","InventarioDetalhe","ItemMovimentoOperacional","MovimentoEstoque","MovimentoOperacional","MovimentoVendaBilheteria","MovimentoVendaBomboniere","ParamMovFiscalTipoMovOper","ParametrosMovimentacaoFiscal","TipoMovimentoOperacional","TipoMovimentoOperacionalOrigem","TpMovOperEstabelecimento","AgrupadorNCM","Bandeira","BandeiraIdentificadorRede","Caixa","CaixaFormaPagamento","Calendario","CalendarioConfiguracao","CanalVendaIngresso","Configuracao","ControleEventoSemana","Deposito","EstabelecimentoConf","EstacaoLocal","EstacaoVenda","EstacaoVendaModeloImpressora","EstacaoVendaPadrao","EstacaoVendaPerfil","FormaPagamento","FormaPgtoBandeira","IdentificadorRede","Justificativa","MapaResumo","MapaResumoTributacao","Mesa","Motivo","NCM","Operacao","OperacaoCaixa","OutroMontante","PerfilVenda","PerfilVendaArea","PerfilVendaIngresso","PerfilVendaProduto","PeriodoDia","RecorrenciaCalendario","SistemaConf","SituacaoTributaria","TipoBloqueio","TipoCaixaDetalhe","TipoCalendario","TipoCanalVenda","TipoCancelamento","TipoComentario","TipoControle","TipoOperacao","TipoPerda","TipoRecorrencia","TipoSistemaVenda","TipoTef","TipoTransacaoAutomatica","TipoVenda","Venda","VendaBilheteriaDetalhe","VendaBomboniereDetalhe","VendaBomboniereReceita","VendaTemporaria","WebService","DispositivoAcessoIngresso","EstabCanalVendaModeloIngresso","Fabricante","LayoutPapel","ModeloImpressora","ModeloImpressoraECF","ModeloImpressoraLayoutPapel","ModeloIngresso","TipoDispositivoAcesso","TipoImpressora","TipoLeitura","TipoPeriferico"];
$(function () {
    $('#r-search').autocomplete({
        source: function (request, response) {
            $.getJSON("/busca/", { q: request.term }, function (data) {
                //cria um array com os objetos de resposta
                var suggestions = [];
                //incluindo elementos que retornaram
                $.each(data, function (i, val) {
                    suggestions.push(val);
                });
                response(suggestions);
            });
        },
        appendTo: "#search-results",
        create: function () {
            //adicionando estilo de pop-up do bootstrap
            $("#search-results .ui-menu")
                        .addClass("dropdown-menu r-search-results")
        },
        open: function () {
            //compensando curvatura da borda do input
            $("#search-results .ui-menu")
                        .width($('#search-results .ui-menu').width() - 13);
            var adjustedLeft = parseFloat($("#search-results .ui-menu").css("left")) + 12.1;
            $("#search-results .ui-menu").css("left", adjustedLeft + "px");
        }
    });
});
